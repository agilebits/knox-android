/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Kotlin library project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/7.5.1/userguide/building_java_projects.html
 */

plugins {
	id 'com.android.library'
	id 'maven-publish'
}

repositories {
	google()
	mavenCentral()
}

android {
	compileSdkVersion 33

	publishing {
		singleVariant("release") {
			withSourcesJar()
		}
	}
}

apply from: file("${rootDir}/lib/gradle.properties")

def KEY = ext.key
def USER = ext.usr
def VERSION = ext.ver

version = VERSION

afterEvaluate {
	publishing {
		publications {
			release(MavenPublication) {
				from components.release
				groupId "com.onepassword"
				artifactId "knox"
				version VERSION

				pom.withXml {
					def dependenciesNode = asNode().appendNode('dependencies')

					configurations.api.allDependencies.each {
						def dependencyNode = dependenciesNode.appendNode('dependency')
						dependencyNode.appendNode('groupId', it.group)
						dependencyNode.appendNode('artifactId', it.name)
						dependencyNode.appendNode('version', it.version)
					}
				}
			}
		}

		repositories {
			maven {
				name = "GitHubPackages"
				url = uri("https://maven.pkg.github.com/agilebits/knox-android")
				credentials {
					password = KEY
					username = USER
				}
			}
		}
	}
}
